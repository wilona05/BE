import{getAllReservations,getReservasiAktif,getReservasiSelesai,getReservasiDibatalkan,getJmlhPemesan,getTotalReservasi,editStatus}from"../services/reservation.service.js";import fs from"fs/promises";export async function renderAdminPage(){const{totalReservasi:e}=await getTotalReservasi(),{reservasiAktif:t}=await getReservasiAktif(),{reservasiSelesai:a}=await getReservasiSelesai(),{reservasiDibatalkan:s}=await getReservasiDibatalkan(),{jmlhPemesan:i}=await getJmlhPemesan(),n=(await getAllReservations()).map((e=>{const t="aktif"===e.status?`<td id="${e.id_reservasi}">\n                    <select name="statusReservasi" id="row-${e.id_reservasi}">\n                    <option value="aktif" selected>aktif</option>\n                    <option value="selesai">selesai</option>\n                    <option value="batal">batal</option>\n                    </select>\n                </td>`:`<td>${e.status}</td>`;return`\n        <tr>\n            <td>${e.id_reservasi}</td>\n            <td>${e.date}</td>\n            <td>${e.nama}</td>\n            <td>${e.kontak}</td>\n            <td>${e.no_meja}</td>\n            <td>${e.jmlh_org}</td>\n            ${t}\n        </tr>\n    `})).join("");return(await fs.readFile("./html/homepage_admin.html","utf8")).replace("{{totalReservasi}}",e).replace("{{reservasiAktif}}",t).replace("{{reservasiSelesai}}",a).replace("{{reservasiDibatalkan}}",s).replace("{{jmlhPemesan}}",i).replace("{{reservationTable}}",n)}export async function handleEditStatus(e,t){let a="";e.on("data",(e=>{a+=e.toString()})),e.on("end",(async()=>{try{const{id:e,status:s}=JSON.parse(a);return"batal"!=s&&"selesai"!=s?(t.writeHead(400,{"Content-Type":"application/json"}),t.end(JSON.stringify({success:!1,message:"Status tidak valid"}))):(await editStatus(e,s),t.writeHead(200,{"Content-Type":"application/json"}),t.end(JSON.stringify({success:!0})))}catch(e){return t.writeHead(500,{"Content-Type":"application/json"}),t.end(JSON.stringify({success:!1,message:"Internal server error"}))}}))}